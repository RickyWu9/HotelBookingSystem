# 酒店预订系统（HBS）软件体系结构文档

## 更新记录

|  时间  | 更新人 | 更新内容                                   |
| :----: | ------ | ------------------------------------------ |
| 陈子合 |  4.21  | 完成3，4.1，4.2，5.1，5.6  |
| 张卓楠 | 4.21 | 添加引言、产品概述，修改逻辑视图和组合视图 |
| 邱星曜 | 4.22 | 完成5.2 |
| 陈子合 | 4.22 | 完成5.5 |
| 张卓楠 | 4.26 | 完成5.3 控制层分解 |
| 刘学卓 | 4.26 | 完成5.4控制层分解 |
| 陈子合 | 5.23 | 添加网站工作人员相关部分 |
| 邱星曜 | 5.23 | 添加注册会员部分，收藏夹部分 |
| 刘学卓 | 5.26 | 工作人员管理 网站营销人员管理 客户信息管理 添加酒店及酒店工作人员 |
| 陈子合 | 6.20 | 完善新增接口的相关描述 |

## 目录
<!-- TOC -->

- [酒店预订系统（HBS）软件体系结构文档](#酒店预订系统hbs软件体系结构文档)
    - [更新记录](#更新记录)
    - [目录](#目录)
    - [1.引言](#1引言)
        - [1.1 编制目的](#11-编制目的)
        - [1.2 词汇表](#12-词汇表)
        - [1.3 参考资料](#13-参考资料)
    - [2.产品概述](#2产品概述)
    - [3.逻辑视图](#3逻辑视图)
    - [4.组合视图](#4组合视图)
        - [4.1 开发包图](#41-开发包图)
        - [4.2 运行时进程](#42-运行时进程)
        - [4.3 物理部署](#43-物理部署)
    - [5.架构设计](#5架构设计)
        - [5.1 模块职责](#51-模块职责)
        - [5.2 用户界面层分解](#52-用户界面层分解)
            - [5.2.1 职责](#521-职责)
            - [5.2.2 接口规范](#522-接口规范)
        - [5.3 控制层分解](#53-控制层分解)
            - [5.3.1 职责](#531-职责)
            - [5.3.2 接口规范](#532-接口规范)
        - [5.4 业务逻辑层分解](#54-业务逻辑层分解)
            - [5.4.1 职责](#541-职责)
            - [5.4.2 接口规范](#542-接口规范)
        - [5.5 数据层分解](#55-数据层分解)
            - [5.5.1 职责](#551-职责)
            - [5.5.2 接口规范](#552-接口规范)
        - [5.6 信息视角](#56-信息视角)
            - [5.6.1 描述数据持久化对象(PO)](#561-描述数据持久化对象po)
            - [5.6.2 数据库表](#562-数据库表)

<!-- /TOC -->

## 1.引言

### 1.1 编制目的

本报告详细完成对酒店预订系统（HBS）的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 | 词汇含义           | 备注                 |
| :------: | ------------------ | -------------------- |
|   HBS    | 酒店预订系统 | Hotel Booking System |

### 1.3 参考资料

1. IEEE标准
2. 酒店预订系统（HBS）用例文档
3. 酒店预订系统（HBS）需求规格说明文档
4. 骆斌，丁二玉，刘钦 - 软件工程与计算 . 卷二 , 软件开发的技术基础 : Software engineering and computing . Volume Ⅱ , Fundamentals of software development technology。

## 2.产品概述

酒店预订系统（HBS）是为旅客和酒店管理方开发的业务系统，开发目标是帮助旅客快速比较和选择酒店，进行酒店预订，同时帮助酒店管理方处理酒店业务，包括酒店信息管理、客房管理、优惠政策和订单管理。

通过酒店预订系统（HBS）的应用，期望降低酒店预订过程中双方的风险，提高酒店的销售额和利润，增加旅客满意度并吸引回头客。

## 3.逻辑视图

酒店预订系统（HBS）中，选择了分层体系结构和风格，将系统分为四层（展示层，控制层，业务逻辑层以及数据层）。展示层包含UI界面的实现，控制层包含业务的访问与控制，业务逻辑层包含业务逻辑的具体实现，数据层负责数据的持久化与访问。分层体系结构的逻辑视角和逻辑设计方案如图1和图2所示。

**图1 软件体系结构逻辑视角**

<img src="https://burger-of-bob.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E5%88%86%E5%B1%821.png" style="zoom: 67%;" />

**图2 软件体系结构逻辑设计方案**

<img src="https://burger-of-bob.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E9%80%BB%E8%BE%91%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88.jpg" style="zoom:80%;" />

## 4.组合视图

### 4.1 开发包图

酒店预订系统（HBS）的开发包图设计如下表所示

|       开发包       | 依赖的其他开发包                                    |
| :----------------: | --------------------------------------------------- |
|      adminUI       | anminController,VO                                  |
|      hotelUI       | hotelController,couponController,orderController,VO |
|   hotelManagerUI   | hotelController,couponController,orderController,VO |
|       userUI       | userController,orderController,VO                   |
|     salesMenUI     | couponController,orderController, AccountController |
|  adminController   | adminBl,VO                                          |
|  hotelController   | hotelBl,VO                                          |
|  couponController  | couponBl,VO                                         |
|  orderController   | orderBl,VO                                          |
|   userController   | accountBl,VO                                        |
| favoriteController | favoritesBI,VO                                      |
|      adminBl       | adminData,VO,PO                                     |
|      hotelBl       | hotelDat,orderBl,userBl,VO,PO                       |
|      couponBl      | couponData,VO,PO                                    |
|      orderBl       | orderData,userBl,VO,PO                              |
|       userBl       | userData,VO,PO                                      |
|     favoriteBI     | favoriteData,VO,PO                                  |
|     adminData      | mybatis,PO                                          |
|     hotelData      | mybatis,PO                                          |
|     couponData     | mybatis,PO                                          |
|     orderData      | mybatis,PO                                          |
|      userData      | mybatis,PO                                          |
|    favoriteData    | mybatis,PO                                          |
|         VO         |                                                     |
|         PO         |                                                     |

酒店预订系统（HBS）客户端开发包图如图3所示，服务器端开发包图如图4所示

**图3 客户端开发包图**

<img src="https://burger-of-bob.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.jpg" style="zoom:67%;" />

**图4 服务器端开发包图**

<img src="https://burger-of-bob.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.jpg" style="zoom:67%;" />

### 4.2 运行时进程

在酒店预订系统（HBS）中，会有多个客户端进程和一个服务器端进程，其进程图如图5所示。结合部署图，客户端进程是在客户端机器上运行，服务器端进程在服务器端机器上运行。

**图5 进程图**

<img src="https://burger-of-bob.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E8%BF%9B%E7%A8%8B%E5%9B%BE.jpg" style="zoom: 80%;" />


### 4.3 物理部署

酒店预订系统（HBS）中，客户端构件是放在客户端机器上的，服务器端构件是放在服务器端机器上的。在客户端节点上，只需要安装现代浏览器（即支持HTML、XHTML、CSS、ECMAScript及W3C DOM标准的浏览器）即可。具体部署图如图6所示。

**图6 部署图**

![](https://burger-of-bob.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E9%83%A8%E7%BD%B2%E5%9B%BE.jpg)

## 5.架构设计

### 5.1 模块职责

酒店预订系统的模块视图如图7所示，其中展示层部署在客户端，控制层，业务逻辑层，数据层以及启动模块都部署在服务器端

**图7 模块视图**

<img src="https://burger-of-bob.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E6%A8%A1%E5%9D%97%E8%A7%86%E5%9B%BE.png" style="zoom:67%;" />

酒店预订系统（HBS）的各层职责如下表所示

|     层     | 职责                                             |
| :--------: | ------------------------------------------------ |
|   展示层   | 显示在客户端浏览器中的用户界面                   |
|   控制层   | 基于用户的请求调用相应的服务                     |
| 业务逻辑层 | 业务逻辑的具体实现                               |
|   数据层   | 数据的持久化以及数据访问接口                     |
|  启动模块  | 负责启动系统，初始化网络通信机制和数据服务的连接 |

每一层只是使用下方直接接触的层。层与层之间仅仅是通过接口的调用来完成的。层之间调用的接口如下表所示

|                             接口                             | 服务调用方 | 服务提供方 |
| :----------------------------------------------------------: | ---------- | ---------- |
| adminController<br>hotelController<br>couponController<br>orderController<br>favoriteController<br>userController | 展示层     | 控制层     |
| adminService<br>hotelService<br>roomService<br>couponService<br>orderService<br>favoriteService<br>accountService | 控制层     | 业务逻辑层 |
| adminMapper<br>hotelMapper<br>roomMapper<br>couponMapper<br>orderMapper<br>favoriteMapper<br>accountMapper | 业务逻辑层 | 数据层     |

借用管理员用例来说明层之间的调用，如图9所示，每一层都是由上层依赖一个接口（需接口），而下层实现这个接口（供接口）。adminController提供了adminUI所需要的功能，adminService提供了adminController所需要调用的服务，adminMapper提供了数据库的增查等操作。这样的实现就大大降低了层与层之间的耦合。

**图9 管理员用例层之间调用的接口**

<img src="https://burger-of-bob.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E7%AE%A1%E7%90%86%E5%91%98%E7%94%A8%E4%BE%8B%E5%B1%82%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B0%83%E7%94%A8.png" style="zoom: 80%;" />

### 5.2 用户界面层分解

​	根据需求，系统现在存在 20个用户界面：登录界面、注册界面、客户主界面、管理人员主界面、个人中心界面、我的订单界面、我的信息界面、酒店列表界面、酒店详情界面、酒店房间信息界面、预定酒店界面、管理界面、酒店管理界面、订单管理界面、添加酒店界面、录入房间界面、优惠策略界面、添加优惠策略界面、删除酒店界面、订单管理界面。用户界面跳转如图10所示。

**图10 界面跳转图**

<img src="https://burger-of-bob.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E5%B1%95%E7%A4%BA%E5%B1%82%E5%88%86%E8%A7%A3.png" style="zoom:80%;" />

#### 5.2.1 职责

展示层模块的职责如下表所示

|      模块      | 职责                                                         |
| :------------: | ------------------------------------------------------------ |
|    adminUI     | 管理员界面，负责允许管理员管理系统用户                       |
|    hotelUI     | 酒店界面，负责实现查看酒店列表，查看酒店详情，查看酒店房间信息，查看优惠政策，预定酒店等操作 |
| hotelManagerUI | 酒店工作人员界面，负责个人信息的修改以及对酒店，酒店房间，酒店优惠政策进行修改 |
|     userUI     | 客户界面，负责个人信息的修改，会员注册以及个人订单的修改     |
|   salesMenUI   | 网站营销人员界面，负责维护促销政策，管理异常订单以及充值信用值 |

#### 5.2.2 接口规范

由于展示层在模块视图中处于最高层，故并不需要提供服务（供接口）

**adminUI模块的接口规范**

| 需要的服务（需接口）           |                      |
| ------------------------------ | -------------------- |
| **服务名**                     | **服务**             |
| AdminController.addUser        | 增加用户             |
| AdminController.getUserList    | 获取某类型用户的信息 |
| AdminController.updateUserInfo | 修改用户信息         |
| AdminController.addHotel       | 添加酒店             |
| AdminController.updateHotel    | 更新酒店信息         |
| AdminController.getUserInfo    | 获取用户信息         |
| AdminController.uploadFile     | 上传酒店图片         |
| AdminController.deleteHotel    | 删除酒店             |
| AdminController.deleteUser     | 删除用户             |

**hotelUI模块的接口规范**

| 需要的服务（需接口）                    |                                |
| --------------------------------------- | ------------------------------ |
| **服务名**                              | **服务**                       |
| HotelController.retrieveAllHotels       | 列表获取酒店信息               |
| HotelController.retrieveHotelDetail     | 获取某家酒店详细信息           |
| OrderController.reserveHotel            | 预订酒店                       |
| OrderController.getEvaluations          | 获取订单评论                   |
| CouponController.getOrderMatchCoupons   | 获取某一订单可用的优惠策略列表 |
| FavoriteController.favorHotel           | 收藏酒店                       |
| FavoriteController.disfavorHotel        | 取消收藏                       |
| FavoriteController.retrieveFavoriteList | 查看收藏夹                     |

**hotelManagerUI模块的接口规范**

| 需要的服务（需接口）                |                          |
| ----------------------------------- | ------------------------ |
| **服务名**                          | **服务**                 |
| HotelController.addRoomInfo         | 添加酒店房间信息         |
| HotelController.updateHotelInfo     | 维护酒店基本信息         |
| HotelController.getHotelByManagerId | 根据mangerId获取酒店信息 |
| OrderController.retrieveHotelOrders | 查看酒店的所有订单       |
| OrderController.checkOutOrder       | 更新退房信息             |
| OrderController.executeOrder        | 执行订单                 |
| CouponController.getHotelAllCoupons | 查看酒店所有优惠策略     |
| CouponController.addCoupon          | 添加酒店优惠策略         |
| CouponController.deleteCoupon       | 删除优惠                 |

**userUI模块的接口规范**

| 需要的服务（需接口）                    |                    |
| --------------------------------------- | ------------------ |
| **服务名**                              | **服务**           |
| AccounController.login                  | 登陆系统           |
| AccounController.registerAccount        | 注册账号           |
| AccounController.getUserInfo            | 查看个人信息       |
| AccounController.updateInfo             | 修改个人信息       |
| AccounController.registerVip            | 注册会员           |
| AccountController.getYipInfo            | 获取会员信息       |
| FavoriteController.favorHotel           | 将酒店添加至收藏夹 |
| FavoriteController.disfavorHotel        | 取消收藏           |
| FavoriteController.retrieveFavoriteList | 查看收藏夹列表     |
| FavoriteController.isFavored            | 判断酒店是否被收藏 |
| OrderController.retrieveUserOrders      | 查看订单           |
| OrderController.annulOrder              | 取消订单           |
| OrderController.appealOrder             | 异常订单进行申诉   |
| OrderController.retrieveOrderById       | 查看某一订单信息   |
| OrderController.processAllLateOrders    | 处理过期订单       |
| OrderController.makeEvaluation          | 评价订单           |
| HotelConteoller.rate                    | 对酒店进行评分     |

**salesMenUI模块的接口规范**

| 需要的服务（需接口）                      |              |
| ----------------------------------------- | ------------ |
| **服务名**                                | **服务**     |
| CouponController.addCoupon                | 添加限时优惠 |
| CouponController.getWebsiteAllCoupon      | 获取网站优惠 |
| CouponController.deleteCoupon             | 删除优惠     |
| OrderController.retrieveExcepitonalOrders | 获取异常订单 |
| OrderController.processExceptionOrder     | 处理申诉订单 |
| AccountController.chargeCredit            | 充值信用值   |

### 5.3 控制层分解

#### 5.3.1 职责

控制层模块的职责如下表所示

|    模块     | 职责                                         |
| :---------: | -------------------------------------------- |
|  adminCon   | 负责实现与酒店工作人员账号管理相关的控制逻辑 |
|  hotelCon   | 负责实现与酒店及客房信息管理相关的控制逻辑   |
|  couponCon  | 负责实现与优惠策略相关的控制逻辑             |
|  orderCon   | 负责实现与预订酒店及订单管理相关的控制逻辑   |
|   userCon   | 负责实现与用户账户相关的控制逻辑             |
| favoriteCon | 负责实现与用户收藏夹相关的控制逻辑           |

#### 5.3.2 接口规范

**adminCon模块的接口规范**

| 提供的服务（供接口）           |                                                              |
| ------------------------------ | ------------------------------------------------------------ |
| AdminController.addUser        | **语法**：ResponseVO addUser( UserVO userVO)<br>**前置条件**：@PostMapping("/addUser")<br>**后置条件**：根据userForm添加用户并返回添加结果 |
| AdminController.getUserList    | **语法**：ResponseVO getUserList(String type)<br>**前置条件**：@PostMapping("/getUserList")<br>**后置条件**：获取并返回某类型用户的信息 |
| AdminController.updateUserInfo | **语法**：ResponseVO updateUserInfo(UserVO userVO)<br/>**前置条件**：@PostMapping("/updateUserInfo")<br/>**后置条件**：更新酒店工作人员信息并返回更新结果 |
| AdminController.addHotel       | **语法**：ResponseVO addHotel(HotelVO hotelVO)<br/>**前置条件**：@PostMapping("/addHotel")<br/>**后置条件**：根据hotelVO添加酒店并返回结果 |
| AdminController.updateHotel    | **语法**：ResponseVo updateHotel(HotelVO hotelVo)<br>**前置条件**：@PostMapping("/updateHotel")<br>**后置条件**：根据hotelVO更新酒店信息 |
| AdminController.getUserInfo    | **语法**：ResponseVO getUserInfo(int id)<br>**前置条件**：@GetMapping("/{id}/getUserInfo")<br>**后置条件**：根据id得到用户信息并返回 |
| AdminController.uploadFile     | **语法**：ResponseVO uploadFile(String hotelId,MultipartFile file)<br>**前置条件**：@PostMapping("/saveFile")<br>**后置条件**：根据hotelId更新酒店图片 |
| AdminController.deleteHotel    | **语法**：ResponseVO deleteHotel(int hotelId)<br>**前置条件**：@GetMapping("/deleteHotel/{hotelId}")<br>**后置条件**：根据hotelId删除酒店 |
| AdminController.deleteUser     | **语法**：ResponseVO deleteUser(int userId)<br>**前置条件**：@GetMapping("deleteUser/{userId}")<br>**后置条件**：根据userId删除用户 |

| 需要的服务（需接口）         |                  |
| ---------------------------- | ---------------- |
| **服务名**                   | **服务**         |
| AdminService.addUser         | 添加用户账号     |
| AdminService.getUserList     | 获得所有用户信息 |
| AdminService.updateUserInfo  | 更新用户信息     |
| AdminService.addHotel        | 添加酒店         |
| AdminService.updateHotelInfo | 更新酒店信息     |
| AdminService.manageUserInfo  | 获取用户信息     |
| AdminService.deleteHotel     | 删除酒店         |
| AdminService.deleteUser      | 删除用户         |
| AdminService.uploadFile      | 上传酒店图片     |

**couponCon模块的接口规范**

| 提供的服务（供接口）                  |                                                              |
| ------------------------------------- | ------------------------------------------------------------ |
| CouponController.getOrderMatchCoupons | **语法**：ResponseVO getOrderMatchCoupons(Integer userId, Integer hotelId, Double orderPrice, Integer roomNum, String checkIn, String checkOut) <br>**前置条件**：@GetMapping("/orderMatchCoupons")<br>**后置条件**：根据userId，hotelId，orderPrice，roomNum，checkIn，checkOut返回订单可用的优惠策略列表 |
| CouponController.getHotelAllCoupons   | **语法**：ResponseVO getHotelAllCoupons(Integer hotelId)<br>**前置条件**：@GetMapping("/hotelAllCoupons")<br>**后置条件**：根据hotelId获取返回酒店所有的优惠策略 |
| CouponController.addCoupon            | **语法**：ResponseVO addCoupon(CouponVO CouponVO)<br>**前置条件**：@PostMapping("/addCoupon")<br>**后置条件**：根据CouponVO添加优惠策略并返回添加结果 |
| CouponController.getWebsiteAllCoupon  | **语法**：ResponseVO getWebsiteAllCoupon()<br>**前置条件**：@GetMapping("/websiteAllCoupon")<br>**后置条件**：得到所有网站优惠策略并返回 |
| CouponController.deleteCoupon         | **语法**：ResponseVo deleteCoupon(int couponId)<br>**前置条件**：@PostMapping("/{couponId}/deleteCoupon")<br>**后置条件**：根据couponId删除优惠并返回结果 |

| 需要的服务（需接口）              |                                              |
| --------------------------------- | -------------------------------------------- |
| **服务名**                        | **服务**                                     |
| CouponService.getMatchOrderCoupon | 返回某一订单可用的优惠策略列表               |
| CouponService.getHotelAllCoupon   | 查看某个酒店提供的所有优惠策略（包括失效的） |
| CouponService.addCoupon           | 添加优惠策略                                 |
| CouponService.deleteCoupon        | 删除优惠策略                                 |
| CouponService.getWebsiteAllCoupon | 获取所有网站优惠策略                         |

**hotelCon模块的接口规范**

| 提供的服务（供接口）                         |                                                              |
| -------------------------------------------- | ------------------------------------------------------------ |
| HotelController.retrieveAllHotels            | **语法**：ResponseVO retrieveAllHotels()<br>**前置条件**：@GetMapping("/all")<br>**后置条件**：获取并返回酒店列表 |
| HotelController.retrieveHotelDetail          | **语法**：ResponseVO retrieveHotelDetail(Integer hotelId)<br>**前置条件**：@GetMapping("/{hotelId}/detail")<br>**后置条件**：根据hotelId返回酒店信息 |
| HotelController.createHotel                  | **语法**：ResponseVO createHotel(HotelVO hotelVO)<br/>**前置条件**：@PostMapping("/addHotel")<br/>**后置条件**：根据hotelVO添加酒店并返回添加结果 |
| HotelController.addRoomInfo                  | **语法**：ResponseVO addRoomInfo(HotelRoom hotelRoom)<br/>**前置条件**：@PostMapping("/addRoomInfo")<br/>**后置条件**：根据hotelRoom添加酒店房间信息并返回添加结果 |
| HotelController.updateHotelInfo              | **语法**：ResponseVO updateHotelInfo(HotelInfoVO hotelInfoVO,int id)<br/>**前置条件**：@PostMapping("/{id}/hotelInfo/update")<br/>**后置条件**：根据hotelInfoVO和id更新酒店基本信息并返回更新结果 |
| HotelController.retrieveHotelDetailByManager | **语法**：ResponseVO retrieveHotelDetailByManager(Integer managerId)<br>**前置条件**：@GetMapping("/{managerId}/managerHotelDetail")<br>**后置条件**：根据managerId获取其管理的酒店信息 |
| HotelController.rate                         | **语法**：ResponseVO rate(Integer hotelId,Map<Object,Double> map)<br>**前置条件**：@PostMapping("{hotelId}/rate")<br>**后置条件**：根据hotelId和map重新计算酒店的评分 |

| 需要的服务（需接口）              |                            |
| --------------------------------- | -------------------------- |
| **服务名**                        | **服务**                   |
| HotelService.addHotel             | 添加酒店                   |
| HotelService.updateHotelInfo      | 维护酒店基本信息           |
| HotelService.retrieveHotels       | 列表获取酒店信息           |
| HotelService.retrieveHotelDetails | 获取某家酒店详细信息       |
| HotelService.rate                 | 计算酒店的评分             |
| RoomService.retrieveHotelRoomInfo | 获取某个酒店的全部房间信息 |
| RoomService.insertRoomInfo        | 添加酒店客房信息           |

**orderCon模块的接口规范**

| 提供的服务（供接口）                      |                                                              |
| ----------------------------------------- | ------------------------------------------------------------ |
| OrderController.reserveHotel              | **语法**：ResponseVO reserveHotel(OrderVO orderVO)<br>**前置条件**：@PostMapping("/addOrder")<br>**后置条件**：根据orderVO预订酒店并返回预订结果 |
| OrderController.retrieveAllOrders         | **语法**：ResponseVO retrieveAllOrders()<br>**前置条件**：@GetMapping("/getAllOrders")<br>**后置条件**：获取并返回所有订单信息 |
| OrderController.retrieveUserOrders        | **语法**：ResponseVO retrieveUserOrders(int userid)<br/>**前置条件**：@GetMapping("/{userid}/getUserOrders")<br/>**后置条件**：根据userid获取并返回指定用户的所有订单信息 |
| OrderController.annulOrder                | **语法**：ResponseVO annulOrder(int orderid)<br/>**前置条件**：@GetMapping("/{orderid}/annulOrder")<br/>**后置条件**：根据orderid撤销订单并返回撤销结果 |
| OrderController.retrieveHotelOrders       | **语法**：ResponseVO retrieveHotelOrders(Integer hotelId)<br/>**前置条件**：@GetMapping("/{hotelId}/allOrders")<br/>**后置条件**：根据hotelId获取并返回酒店的所有订单 |
| OrderController.retrieveExceptionalOrders | **语法**：ResponseVO retrieveExcetionalOrders()<br>**前置条件**：@GetMapping("/getExceptionalOrders")<br>**后置条件**：获取并返回所有异常订单信息 |
| OrderController.checkOutOrder             | **语法**：ResponseVO checkOutOrder(int orderid)<br/>**前置条件**：@GetMapping("/checkOutOrder")<br/>**后置条件**：根据orderid更新退房信息并返回退房结果 |
| OrderController.executeOrder              | **语法**：ResponseVO reserveHotel(int orderid)<br/>**前置条件**：@GetMapping("/executeOrder")<br/>**后置条件**：根据orderid执行订单并返回执行结果 |
| OrderController.appealOrder               | **语法**：ResponseVO appealOrder(int orderid)<br>**前置条件**：@PostMapping("/{orderid}/appealOrder")<br>**后置条件**：根据orderid进行订单申诉 |
| OrderController.processExceptionOrder     | **语法**：ResponseVO processExceptionOrder(int orderid)<br>**前置条件**：@PostMapping("/{orderid}/processExceptionOrder")<br>**后置条件**：根据orderid进行订单申诉 |
| OrderController.processAllLateOrder       | **语法**：ResponseVO processAllLateOrder()<br>**前置条件**：@PostMapping("/processAllLateOrders")<br>**后置条件**：将所有超时订单状态置为异常 |
| OrderController.retrieveOrderById         | **语法**：ResponseVO retrieveOrderById(int orderId)<br>**前置条件**：@GetMapping("/{orderId}/getOrderById")<br>**后置条件**：根据orderId获取订单 |
| OrderController.makeEvaluation            | **语法**：ResponseVO makeEvaluation(int orderId, Map<Object,String> map)<br>**前置条件**：@PostMapping("/{orderId}/evaluate")<br>**后置条件**：根据orderId以及map为订单添加评论 |
| OrderController.getEvaluations            | **语法**：ResponseVO getEvaluations(Integer hotelId)<br>**前置条件**：@GetMapping("/{hotelId}/evaluations")<br>**后置条件**：根据hotelId返回酒店的所有评价 |

| 需要的服务（需接口）              |                            |
| --------------------------------- | -------------------------- |
| **服务名**                        | **服务**                   |
| OrderService.addOrder             | 预订酒店                   |
| OrderService.getAllOrders         | 获得所有订单信息           |
| OrderService.getUserOrders        | 获得指定用户的所有订单信息 |
| OrderService.annulOrder           | 撤销订单                   |
| OrderService.getHotelOrders       | 查看酒店的所有订单         |
| OrderService.getExceptionalOrders | 获得所有异常订单           |
| OrderService.checkOutOrder | 更新退房信息         |
| OrderService.executeOrder | 执行订单             |
| OrderService.appealOrder | 申诉异常订单 |
| OrderService.processExceptionOrder | 处理申诉订单 |
| OrderService.processAllLateOrders | 处理所有超时订单 |
| OrderService.getOrderById | 获取某一订单 |
| OrderService.makeEvaluation | 对某一订单作出评论 |
| OrderService.getEvaluations | 获取酒店所有评论 |

**userCon模块的接口规范**

| 提供的服务（供接口）                  |                                                              |
| ------------------------------------- | ------------------------------------------------------------ |
| AccountController.login               | **语法**：ResponseVO login(UserForm userForm)<br>**前置条件**：@PostMapping("/login")<br>**后置条件**：根据userForm进行用户登录并返回登录结果 |
| AccountController.registerAccount     | **语法**：ResponseVO registerAccount(UserVO userVO)<br>**前置条件**：@PostMapping("/register")<br>**后置条件**：根据userVO注册账户并返回注册结果 |
| AccountController.registerPersonalVip | **语法**：ResponseVO registerPersonalVIP(UserVO userVO)<br/>**前置条件**：@PostMapping("/{id}/userInfo/registerPersonalVIP")<br>**后置条件**:   根据userVO注册个人会员并且返回注册结果 |
| AccountController.registerCompanyVip  | **语法**：ResponseVO registerCompanyVIP(UserVO userVO)<br/>**前置条件**：@PostMapping("/{id}/userInfo/registerCompanyVIP")<br/>**后置条件**:   根据userVO注册企业会员并且返回注册结果 |
| AccountController.getUserInfo         | **语法**：ResponseVO getUserInfo(int id)<br/>**前置条件**：@GetMapping("/{id}/getUserInfo")<br/>**后置条件**：根据id获取并返回用户个人信息 |
| AccountController.getVipInfo          | **语法**：ResponseVO getVipInfo(int id)<br>**前置条件**：@GetMapping("/{id}/getVipInfo")<br>**后置条件**：根据id获取用户vip信息并返回 |
| AccountController.updateInfo          | **语法**：ResponseVO updateInfo(UserInfoVO userInfoVO, int id)<br/>**前置条件**：@PostMapping("/{id}/userInfo/update")<br/>**后置条件**：根据userInfoVO和id更新用户个人信息并返回更新结果 |
| AccountController.chargeCredit        | **语法**：ResponseVO chargeCredit(int id, int credit)<br>**前置条件**：<br>**后置条件**：根据id以及credit增加用户的信用值并返回添加结果 |

| 需要的服务（需接口）                   |                                               |
| -------------------------------------- | --------------------------------------------- |
| **服务名**                             | **服务**                                      |
| AccountService.registerAccount         | 注册账号                                      |
| AccountService.login                   | 用户登录，登录成功会将用户信息保存在session中 |
| AccountService.registerPersonalVIP     | 用户注册个人会员                              |
| AccountService.registerCompanyVIP      | 用户注册企业会员                              |
| AccountService.getUserInfo             | 获取用户个人信息                              |
| AccountService.getVipInfo              | 获取会员信息                                  |
| AccountService.updateUserInfo          | 更新用户个人信息                              |
| AccountService.updateUserCreditByEmail | 添加信用值                                    |

**favorCon模块的接口规范**

| 提供的服务（供接口）                    |                                                              |
| --------------------------------------- | ------------------------------------------------------------ |
| FavoriteController.favorHotel           | **语法**：ResponseVO favorHotel(Integer userid, Integer hotelid)<br>**前置条件**：@PostMapping("/addFavor")<br>**后置条件**：返回收藏成功 |
| FavoriteController.disfavorHotel        | **语法**：ResponseVO disfavorHotel(Integer userid, Integer hotelid)<br/>**前置条件**：@PostMapping("/removeFavor")<br/>**后置条件**：返回取消收藏成功 |
| FavoriteController.retrieveFavoriteList | **语法**：ResponseVO retrieveFavoriteList(int userid)<br/>**前置条件**：@GetMapping("/{id}/favorite")<br/>**后置条件**：根据userid获取并返回指定用户的收藏信息 |
| FavoriteController.isFavored            | **语法**：ResponseVO isFavored(Integer id, Integer hotelId)<br>**前置条件**：@GetMapping("/{id}/{hotelId}/isFavored")<br>**后置条件**：根据id以及hotelId判断用户是否收藏该酒店 |

| 需要的服务（需接口）          |                        |
| ----------------------------- | ---------------------- |
| **服务名**                    | **服务**               |
| FavoriteService.addFavor      | 收藏酒店               |
| FavoriteService.removeFavor   | 取消收藏               |
| FavoriteService.getUserFavors | 获得指定用户的收藏信息 |
| FavoriteService.isFavored     | 判断是否收藏某酒店     |

### 5.4 业务逻辑层分解

#### 5.4.1 职责

业务逻辑层的职责如下表所示

|   模块   | 职责                                                         |
| :------: | ------------------------------------------------------------ |
| adminBL  | 负责实现管理员管理系统用户                                   |
| couponBL | 负责添加、查看优惠策略以及判断订单是否满足优惠策略           |
| hotelBL  | 负责添加酒店、提供所有酒店信息、管理各个酒店信息以及管理酒店的客房信息 |
| orderBL  | 负责预定、取消、查看用户订单以及查看酒店订单信息             |
|  userBL  | 负责用户的注册与登陆以及查看、更新用户信息、注册会员         |
| favorBL  | 负责用户收藏酒店，删除酒店查看收藏夹                         |

#### 5.4.2 接口规范

业务逻辑层的接口规范如下表所示

**adminBL模块的接口规范**

| 提供的服务（供接口）        |                                                              |
| --------------------------- | ------------------------------------------------------------ |
| AdminService.addUser        | **语法**：ResponseVO addUser(UserVO userVO)<br>**前置条件** ：userForm不为null并且未被注册<br>**后置条件**：根据userForm向数据库中添加管理人员信息 |
| AdminService.getUserList    | **语法**：List<User> getAllManagers(String type)<br>**前置条件**：无<br>**后置条件**：获得type类型用户信息的列表 |
| AdminService.updateUserInfo | **语法**：ResponseVO updateUserInfo(UserVO userVO)<br/>**前置条件** ：userVO不为null<br/>**后置条件**：根据userVO修改数据库中用户信息 |
| AdminService.addHotel       | **语法**：ResponseVO addHotel(HotelVO hotelVO)<br/>**前置条件**：hotelVO不为null<br/>**后置条件**：根据hotelVO添加酒店并返回结果 |
| AdminService.updateHotel    | **语法**：ResponseVO updateHotel(HotelVO hotelVO)<br>**前置条件**：hotelVO不为空<br>**后置条件**：根据hotelVO更新酒店信息并返回结果 |
| AdminService.manageUserInfo | **语法**：UserVO manageUserInfo(int id)<br>**前置条件**：<br>**后置条件**：根据id返回用户信息 |
| AdminService.uploadFile     | **语法**：ResponseVO uploadFile(String hotelId, File file)<br>**前置条件**：<br>**后置条件**：根据hotelId上传酒店照片 |
| AdminService.deleteHotel    | **语法**：ResponseVO deleteHotel(int hotelId)<br>**前置条件**：无<br>**后置条件**：根据hotelId删除酒店 |
| AdminService.deleteUser     | **语法**：ResponseVO deleteUser(int userId)<br/>**前置条件**：无<br/>**后置条件**：根据userId删除酒店 |

| 需要的服务（需接口）       | 服务                                   |
| -------------------------- | -------------------------------------- |
| AdminMapper.addUser        | 根据user向数据库中增加一条用户信息     |
| AdminMapper.getUserList    | 获取数据库中type类型所有用户列表并返回 |
| AdminMapper.updateUserInfo | 根据user修改数据库中用户信息           |
| AdminMapper.addHotel       | 根据hotel向数据库中添加酒店            |
| AdminMapper.updateHotel    | 更新酒店信息                           |
| AdminMapper.manegeUserInfo | 获取用户信息                           |
| AdminMapper.getHotelInfo   | 获取酒店信息                           |
| AdminMapper.deleteHotel    | 删除酒店                               |
| AdminMapper.deleteUser     | 删除用户                               |

**couponBL模块的接口规范**

| 提供的接口（供接口）              |                                                              |
| --------------------------------- | ------------------------------------------------------------ |
| CouponMatchStrategy.isMatch       | **语法**: boolean isMatch(OrderVO orderVO, Coupon coupon)<br>**前置条件**:无<br>**后置条件**:返回该订单是否满足优惠的布尔值 |
| CouponService.getMatchOrderCoupon | **语法**: List<Coupon> getMatchOrderCoupon(OrderVO orderVO)<br>**前置条件**:无<br>**后置条件**:返回某一订单可用的优惠策略列表 |
| CouponService.getHotelAllCoupon   | **语法**: List<Coupon> getHotelAllCoupon(Integer hotelId)<br>**前置条件**:无<br>**后置条件**:返回hotelId酒店提供的所有优惠策略（包括失效的） |
| CouponService.getHotelAllCoupon   | **语法**：List<Coupon> getWebsiteAllCoupon()<br>**前置条件**：无<br>**后置条件**：得到并返回所有网站优惠策略 |
| CouponService.addCoupon           | **语法**: CouponVO addCoupon(CouponVO couponVO)<br>**前置条件**:无<br>**后置条件**:添加优惠策略 |
| CouponService.deleteCoupon        | **语法**：ResponseVO deleteCoupon(int couponId)<br>**前置条件**：无<br>**后置条件**：根据couponId来删除优惠策略 |

| 需要的接口（需接口）             | 服务                                          |
| -------------------------------- | --------------------------------------------- |
| CouponMapper.insertCoupon        | 根据coupon向数据库中增加一条优惠券信息        |
| CouponMapper.selectByHotelId     | 根据hotelId获取数据库中该酒店优惠券列表并返回 |
| CouponMapper.selectWebsiteCoupon | 获取网站优惠策略                              |
| CouponMapper.deleteCoupon        | 删除优惠策略                                  |

**hotelBL模块的接口规范**

| 提供的接口（供接口）                      |                                                              |
| ----------------------------------------- | ------------------------------------------------------------ |
| HotelService.addHotel                     | **语法**：void addHotel(HotelVO hotelVO) throws ServiceException<br>**前置条件**：hotelVO不为null且没有被注册<br>**后置条件**：添加houtelVO酒店 |
| HotelService.updateHotelInfo              | **语法**：ResponseVO updateHotelInfo(HotelInfoVO hotelInfoVO,Integer id)<br/>**前置条件**：<br/>**后置条件**：更新对应酒店信息 |
| HotelService.updateRoomInfo               | **语法**：void updateRoomInfo(Integer hotelId, String roomType,Integer rooms)<br>**前置条件**：<br>**后置条件**：更新hotelId酒店剩余客房信息 |
| HotelService.retrieveHotels               | **语法**：List<HotelVO> retrieveHotels()<br>**前置条件**：无<br>**后置条件**：返回酒店信息的列表 |
| HotelService.retrieveHotelDetails         | **语法**：HotelVO retrieveHotelDetails(Integer hotelId)<br>**前置条件**：hotelId不为null且存在<br>**后置条件**：返回hotelId酒店的详细信息 |
| HotelService.retrieveHotelDetailByManager | **语法**：HotelVO retrieveHotelDetailByManager(Integer managerId)<br>**前置条件**：<br>**后置条件**：根据managerId得到酒店信息 |
| HotelService.getRoomCurNum                | **语法**：int getRoomCurNum(Integer hotelId,String roomType)<br>**前置条件**：hotelId不为null且存在<br>**后置条件**：返回hotleId酒店roomType类型的房间数量 |
| HotelService.rate                         | **语法**：ResponseVO rate(Integer hotelId, double rate)<br>**前置条件**：无<br>**后置条件**：根据hotelId以及rate重新计算酒店评分 |
| RoomService.retrieveHotelRoomInfo         | **语法**：List<HotelRoom> retrieveHotelRoomInfo(Integer hotelId)<br>**前置条件**：hotelId不为null且存在<br>**后置条件**:返回hotelId酒店的全部信息 |
| RoomService.insertRoomInfo                | **语法**：void insertRoomInfo(HotelRoom hotelRoom)<br>**前置条件**：无<br>**后置条件**：添加酒店客房信息 |
| RoomService.updateRoomInfo                | **语法**：void updateRoomInfo(Integer hotelId, String roomType, Integer rooms)<br>**前置条件**：hotelId不为null且存在<br>**后置条件**：预定酒店之后更新该酒店客房房间数量 |
| RoomService.getRoomCurNum                 | **语法**：int getRoomCurNum(Integer hotelId, String roomType)<br>**前置条件**：hotelId不为null且存在<br>**后置条件**：返回hotelId酒店roomType类型的房间数量 |

| 需要的接口（需接口）            | 服务                                                         |
| ------------------------------- | ------------------------------------------------------------ |
| HotelMapper.insertHotel         | 根据hotel向数据库中增加一条酒店信息                          |
| HotelMapper.updateHotelInfo     | 根据id更新对应酒店的名称、地址、商圈、星级、描述、电话号码信息 |
| HotelMapper.selectAllHotel      | 返回数据库中酒店列表                                         |
| HotelMapper.selectById          | 根据id获取数据库中对应酒店信息并返回                         |
| HotelMapper.selectByManagerId   | 根据managerId返回酒店信息                                    |
| HotelMapper.rate                | 更新酒店评分                                                 |
| RoomMapper.insertRoom           | 根据hotelRoom向数据库中增加一条房间信息                      |
| RoomMapper.selectRoomsByHotelId | 根据hotelId获取数据库中对应的酒店房间列表并返回              |
| RoomMapper.getRoomCurNum        | 根据hotelId以及roomType获取数据库中对应房间的剩余数量并返回  |

**orderBL的接口规范**

| 提供的接口（供接口）              |                                                              |
| --------------------------------- | ------------------------------------------------------------ |
| OrderService.addOrder             | **语法**：ResponseVO addOrder(OrderVO orderVO)<br>**前置条件**：无<br>**后置条件**：根据orderVO预定酒店 |
| OrderService.getAllOrders         | **语法**：List<Order> getAllOrders()<br>**前置条件**：无<br>**后置条件**：返回包含所有订单信息的列表 |
| OrderService.getUserOrders        | **语法**：List<Order> getUserOrders(int userid)<br>**前置条件**：无<br>**后置条件**：返回userid用户的所有订单信息 |
| OrderService.annulOrder           | **语法**：ResponseVO annulOrder(int orderid)<br>**前置条件**：无<br>**后置条件**：撤销orderid的订单 |
| OrderService.getOrderById         | **语法**：List<Order> getHotelOrders(Integer hotelId)<br>**前置条件**：无<br>**后置条件**：返回包含hotelId酒店所有订单信息的列表 |
| OrderService.getExceptionOrders | **语法**：List<Order> getExceptionOrders()<br>**前置条件**：无<br>**后置条件**：返回所有已申诉异常订单信息的列表 |
| OrderService.checkOutOrder | **语法**：List<Order> checkOutOrder(int orderid)<br/>**前置条件**：无<br/>**后置条件**：更新orderid订单的退房信息 |
| OrderService.executeOrder | **语法**：List<Order> executeOrder(int orderid)<br/>**前置条件**：无<br/>**后置条件**：执行orderid订单 |
| OrderService.appealOrder | **语法**：ResponseVO appealOrder(int orderId)<br>**前置条件**：无<br>**后置条件**：根据orderId对订单进行申诉 |
| OrderService.processExceptionOrder | **语法**：ResponseVO processExceptionOrder(int orderId)<br>**前置条件**：无<br>**后置条件**：根据orderId来处理申诉订单 |
| OrderService.processAllLateOrders | **语法**：ResponseVO processAllLateOrders()<br>**前置条件**：无<br>**后置条件**：将所有超时订单状态更改为异常 |
| OrderService.makeEvaluation | **语法**：ResponseVO makeEvaluation(int orderId, String evaluation)<br>**前置条件**：无<br>**后置条件**：根据orderId以及evaluation向订单添加一条评论 |
| OrderService.getEvaluations | **语法**：List<Order> getEvaluations(int hotelId)<br>**前置条件**：无<br>**后置条件**：根据hotelId获取酒店所有评价 |

| 需要的服务（需接口）                  | 服务                                        |
| ------------------------------------- | ------------------------------------------- |
| OrderMapper.addOrder     | 根据order向数据库中增加一条订单信息         |
| OrderMapper.getAllOrders            | 获取数据库中所有订单列表并返回              |
| OrderMapper.getUserOrders | 根据userid获取数据库中对应的订单列表并返回  |
| OrderMapper.annulOrder   | 根据orderid更新数据库中对应订单的状态信息     |
| OrderMapper.getOrderById | 根据orderid获取数据库中对应的订单信息并返回 |
| OrderMapper.getExceptionalOrders    | 获取数据库中的异常订单列表并返回            |
| OrderMapper.checkOutOrder | 根据orderid更新退房信息 |
| OrderMapper.executeOrder | 根据orderid执行订单并更新订单信息 |
| OrderMapper.appealOrder | 申诉订单 |
| OrderMapper.changeOrderStateToException | 将订单状态更改为异常 |
| OrderMapper.makeEvaluation | 为订单增加一条评论 |
| OrderMapper.getEvaluations | 获取酒店所有评论 |

**userBL的接口规范**

| 提供的接口（供接口）                   |                                                              |
| -------------------------------------- | ------------------------------------------------------------ |
| AccountService.registerAccount         | **语法**：ResponseVO registerAccount(UserVO userVO)<br>**前置条件**：userVO不为null且未被注册<br>**后置条件**:返回注册结果response |
| AccountService.login                   | **语法**：User login(UserForm userForm)<br>**前置条件**：无<br>**后置条件**:用户登陆成功后，在session中保存用户信息 |
| AccountService.registerPersonalVIP     | **语法**：ResponseVO registerPersonalVIP(VipPersonVO vipPersonVO<br/>**前置条件**：无<br/>**后置条件**: 将用户添加为个人会员 |
| AccountService.registerCompanyVIP      | **语法**：ResponseVO registerComponyVIP(VipCompanyVO vipComponyVO<br/>**前置条件**：无<br/>**后置条件**: 将用户添加为个人会员 |
| AccountService.getUserInfo             | **语法**：User getUserInfo(int id)<br>**前置条件**：无<br>**后置条件**:返回id的用户个人信息 |
| AccountService.getVipInfo              | **语法**：Vip getVipInfo(int id)<br>**前置条件**：无<br>**后置条件**：根据id返回会员信息 |
| AccountService.updateUserInfo          | **语法**：ResponseVO updateUserInfo(int id, String password,String username,String phonenumber)<br>**前置条件**：无<br>**后置条件**:根据password、username、phonenumber更新id的用户个人信息 |
| AccountService.updateUserCredit        | **语法**：ResponseVO updateUserCredit(int id, double credit)<br/>**前置条件**：<br/>**后置条件**：根据id, credit向用户添加信用值 |
| AccountService.updateUserCreditByEmail | **语法**：ResponseVO updateUserCreditByEmail(String email, double credit)<br>**前置条件**：<br>**后置条件**：根据email, credit向用户充值信用值 |

| 需要的服务（需接口）              | 服务                                               |
| --------------------------------- | -------------------------------------------------- |
| AccountMapper.createNewAccount    | 根据user向数据库中增加一条账号信息                 |
| AccountMapper.getAccountByName    | 根据email获取数据库中对应的账号并返回              |
| AccountMapper.getAccountById      | 根据id获取数据库中对应的账号并返回                 |
| AccountMapper.updateAccount       | 根据id更新数据库中对应账号的密码，用户名，电话号码 |
| AccountMapper.registerPersonalVIP | 注册个人会员                                       |
| AccountMapper.registerCompanyVIP  | 注册公司会员                                       |
| AccountMapper.updateCredit        | 根据id更新信用值                                   |
| AccountMapper.getVipInfoById      | 获取会员信息                                       |

**favorBL的接口规范**

| 提供的服务（供接口）                 |                                                              |
| ------------------------------------ | ------------------------------------------------------------ |
| **服务名**                           |                                                              |
| FavoriteService.favorHotel           | **语法**：ResponseVO favorHotel(Interger userid, Integer hotelid)<br/>**前置条件**：无<br/>**后置条件**：将用户id与酒店id绑定 |
| FavoriteService.disfavorHotel        | **语法**：ResponseVO disfavorHotel(Interger userid, Integer hotelid)<br/>**前置条件**：无<br/>**后置条件**：将用户id与酒店id解绑 |
| FavoriteService.retrieveFavoriteList | **语法**：List<hotel> retrieveFavoriteList(Interger userid)<br/>**前置条件**：无<br/>**后置条件**：返回特定用户id下的收藏酒店列表 |
| FavoriteService.isFavored            | **语法**：int isFavored(Integer userId, Integer hotelId)<br>**前置条件**：无<br>**后置条件**：返回用户是否收藏某酒店 |

| 需要的服务（需接口）                | 服务                                           |
| ----------------------------------- | ---------------------------------------------- |
| FavoriteMapper.favorHotel           | 根据用户id和酒店id向数据库中增加一条收藏       |
| FavoriteMapper.disfavorHotel        | 根据用户id和酒店id向数据库中删除一条收藏       |
| FavoriteMapper.retrieveFavoriteList | 根据userid获取数据库中对应的收藏酒店列表并返回 |
| FavoriteMapper.isFavored            | 返回用户是否收藏某酒店                         |

### 5.5 数据层分解

#### 5.5.1 职责

数据层模块的职责如下表所示

| 模块       | 职责                                     |
| ---------- | ---------------------------------------- |
| adminData  | 提供与酒店工作人员有关数据的增、查       |
| couponData | 提供与优惠券有关数据的增、查             |
| hotelData  | 提供与酒店和房间信息有关数据的增、改、查 |
| orderData  | 提供与订单信息有关数据的增，查           |
| userData   | 提供与用户账号信息有关数据的增，查，改   |
| favorData  | 提供与用户收藏夹有关数据的增，查，改     |

#### 5.5.2 接口规范

数据层位于分层结构中的最底层，故不需要其他层次向其提供服务(需接口)

**adminData模块的接口规范**

| 提供的服务（供接口）       |                                                              |
| -------------------------- | ------------------------------------------------------------ |
| AdminMapper.addUser        | **语法**：int addUser(User user)<br>**前置条件**：user不为null且符合输入格式<br>**后置条件**：根据user向数据库中增加一条用户信息 |
| AdminMapper.getUserList    | **语法**：List<User> getUserList(String type)<br>**前置条件**：无<br>**后置条件**：获取数据库中type类型所有用户列表并返回 |
| AdminMapper.updateUserInfo | **语法**：int updateUserInfo(User user)<br/>**前置条件**：无<br/>**后置条件**：根据user修改数据库中用户信息 |
| AdminMapper.addHotel       | **语法**：int addHotel(Hotel hotel)<br/>**前置条件**：hotel不为null且符合输入格式<br/>**后置条件**：根据hotel向数据库中添加酒店 |
| AdminMapper.updateHotel    | **语法**：int updateHotel(Hotel hotel)<br>**前置条件**：无<br>**后置条件**：根据hotel更新酒店信息 |
| AdminMapper.manageUserInfo | **语法**：User managerUserInfo(int id)<br>**前置条件**：无<br>**后置条件**：根据id获取用户信息 |
| AdminMapper.getHotelInfo   | **语法**：Hotel getHotelInfo(int hotelId)<br>**前置条件**：无<br>**后置条件**：根据hotelId获取酒店信息 |
| AdminMapper.deleteHotel    | **语法**：int deleteHotel(int id)<br/>**前置条件**：无<br/>**后置条件**：根据id删除酒店 |
| AdminMapper.deleteUser     | **语法**：int deleteUser(int id)<br/>**前置条件**：无<br/>**后置条件**：根据id删除用户 |

**couponData模块的接口规范**

| 提供的服务（供接口）            |                                                              |
| ------------------------------- | ------------------------------------------------------------ |
| CouponMapper.insertCoupon       | **语法**：int insertCoupon(Coupon coupon)<br>**前置条件**：coupon不为null且符合输入格式<br>**后置条件**：根据coupon向数据库中增加一条优惠券信息 |
| CouponMapper.selectByHotelId    | **语法**：Liset<Coupon> selectByHotelId(Integer hotelId)<br>**前置条件**：无<br>**后置条件**：根据hotelId获取数据库中该酒店优惠券列表并返回 |
| CouponMapper.selectWebiteCoupon | **语法**：List<Coupon> selectWebsiteCoupon()<br>**前置条件**：<br>**后置条件**：返回所有网站优惠策略 |
| CouponMapper.deleteCoupon       | **语法**：int deleteCoupon(int couponId)<br>**前置条件**：<br>**后置条件**：根据couponId删除优惠策略 |

**hotelData模块的接口规范**

| 提供的服务（供接口）            |                                                              |
| ------------------------------- | ------------------------------------------------------------ |
| HotelMapper.insertHotel         | **语法**：int insertHotel(Hotel hotel)<br>**前置条件**：hotel不为null且符合输入格式<br>**后置条件**：根据hotel向数据库中增加一条酒店信息 |
| HotelMapper.updateHotel         | **语法**：int updateHotelInfo(Integer id,String name,String address,String bizRegion,String hotelStar,String description,String phoneNum)<br/>**前置条件**：无<br/>**后置条件**：根据id更新对应酒店的名称、地址、商圈、星级、描述、电话号码信息 |
| HotelMapper.selectAllHotel      | **语法**：List<HotelVO> selectAllHotel<br>**前置条件**：无<br>**后置条件**：获取数据库中酒店列表并返回 |
| HotelMapper.selectById          | **语法**：HotelVO selectById(Integer id)<br>**前置条件**：无<br>**后置条件**：根据id获取数据库中对应酒店信息并返回 |
| HotelMapper.selectByManagerId   | **语法**：HotelVO selectByManagerId(Integer ,manager_id)<br>**前置条件**：无<br>**后置条件**：根据manager_id得到酒店信息 |
| HotelMapper.rate                | **语法**：void rate(Integer,hotelId,Double rate)<br>**前置条件**：无<br>**后置条件**：根据rate重新计算酒店的评分 |
| RoomMapper.updateRoomInfo       | **语法**：int updateRoomInfo(Integer hotelId,String roomType,Integer curNum)<br>**前置条件**：无<br>**后置条件**：根据hotelId以及roomType更新数据库中对应的房间数量 |
| RoomMapper.insertRoom           | **语法**：int insertRoom(HotelRoom hotelRoom)<br>**前置条件**：hotelRoom不为null且符合输入格式<br>**后置条件**：根据hotelRoom向数据库中增加一条房间信息 |
| RoomMapper.selectRoomsByHotelId | **语法**：List<HotelRoom> selectRoomByHotelId<br>**前置条件**：无<br>**后置条件**：根据hotelId获取数据库中对应的酒店房间列表并返回 |
| RoomMapper.getRoomCurNum        | **语法**：int getRoomCurNum(Integet hotelId,String roomType)<br>**前置条件**：无<br>**后置条件**：根据hotelId以及roomType获取数据库中对应房间的剩余数量并返回 |

**orderData模块的接口规范**

| 提供的服务（供接口）             |                                                              |
| -------------------------------- | ------------------------------------------------------------ |
| OrderMapper.addOrder             | **语法**：int addOrder(Order order)<br>**前置条件**：order不为null且符合输入标准<br>**后置条件**：根据order向数据库中增加一条订单信息 |
| OrderMapper.getAllOrders         | **语法**：List<Order> getAllOrders()<br>**前置条件**：无<br>**后置条件**：获取数据库中所有订单列表并返回 |
| OrderMapper.getUserOrders        | **语法**：List<Order> getUserOrders(int userid)<br>**前置条件**：无<br>**后置条件**：根据userid获取数据库中对应的订单列表并返回 |
| OrderMapper.annulOrder           | **语法**：int annulOrder(int orderid)<br>**前置条件**：无<br>**后置条件**：根据orderid更新数据库中对应订单的状态信息 |
| OrderMapper.getOrderById         | **语法**：Order getOrderById(int orderid)<br>**前置条件**：无<br>**后置条件**：根据orderid获取数据库中对应的订单信息并返回 |
| OrderMapper.getExceptionalOrders | **语法**：List<Order> getExceptionalOrders()<br>**前置条件**：<br>**后置条件**：获取数据库中所有异常订单列表并返回 |
| OrderMapper.checkOutOrder | **语法**：List<Order> checkOutOrder(int orderid)<br/>**前置条件**：无<br/>**后置条件**：根据orderid更新数据库中对应订单的状态信息 |
| OrderMapper.executeOrder | **语法**：List<Order> executeOrder(int orderid)<br/>**前置条件**：无<br/>**后置条件**：根据orderid更新数据库中对应订单的状态信息 |
| OrderMapper.appealOrder | **语法**：int appealOrder(int orderId)<br>**前置条件**：无<br>**后置条件**：根据orderId进行订单申诉 |
| OrderMapper.changeOrderStateToException | **语法**：int changeOrderStateToException(int orderId)<br>**前置条件**：无<br>**后置条件**：根据orderId更改订单状态 |
| OrderMapper.makeEvaluation | **语法**：void makeEvaluation(int orderId,String evaluation)<br>**前置条件**：无<br>**后置条件**：根据evaluation向订单添加一条评论 |
| OrderMapper.getEvaluations | **语法**：List<Order> getEvaluations(int hotelId)<br>**前置条件**：无<br>**后置条件**：根据hotelId返回有评论的订单 |

**userData模块的接口规范**

| 提供的服务（供接口）              |                                                              |
| --------------------------------- | ------------------------------------------------------------ |
| AccountMapper.createNewAccount    | **语法**：int createNewAccount(User user)<br>**前置条件**：user不为null且符合输入标准<br>**后置条件**：根据user向数据库中增加一条账号信息 |
| AccountMapper.getAccountByName    | **语法**：User getAccountByName(String email)<br>**前置条件**：无<br>**后置条件**：根据email获取数据库中对应的账号并返回 |
| AccountMapper.getAccountById      | **语法**：User getAccountById(int id)<br>**前置条件**：无<br>**后置条件**：根据id获取数据库中对应的账号并返回 |
| AccountMapper.getVipinfoById      | **语法**：Vip getVipInfoById(int id)<br>**前置条件**：无<br>**后置条件**：根据id获取会员信息 |
| AccountMapper.registerPersonalVIP | **语法**：int registerPersonalVIP(Vip vip)<br/>**前置条件**：无<br/>**后置条件**：注册个人会员 |
| AccountMapper.registerCompanyVIP  | **语法**：int registerCompanyVIP(Vip vip)<br/>**前置条件**：无<br/>**后置条件**：注册公司会员 |
| AccountMapper.updateAccount       | **语法**：int updateAccount(int id,String password,String username,String phoneNumber)<br>**前置条件**：无<br>**后置条件**：根据id更新数据库中对应账号的密码，用户名，电话号码 |
| AccountMapper.updateCredit        | **语法**：int addCredit(int id, double credit)<br>**前置条件**：<br>**后置条件**：根据id以及credit增加用户的信用值 |

**adminData模块的接口规范**

| 提供的服务（供接口）                |                                                              |
| ----------------------------------- | ------------------------------------------------------------ |
| FavoriteMapper.favorHotel           | **语法**：int favorHotel(Integer userid, Integer hotelid)<br/>**前置条件**：<br/>**后置条件**：根据userid以及hotelid更新数据库中的收藏夹内容 |
| FavoriteMapper.disfavorHotel        | **语法**：int disfavorHotel(Integer userid, Integer hotelid)<br/>**前置条件**：<br/>**后置条件**：根据userid以及hotelid更新数据库中的收藏夹内容 |
| FavoriteMapper.retrieveFavoriteList | **语法**：List<hotel>  retrieveFavoriteList(Integer userid)<br/>**前置条件**：<br/>**后置条件**：根据userid返回其收藏夹内容 |
| FavoriteMapper.isFavored            | **语法**：int isFavored(Interger userId, Integer hotelId)<br>**前置条件**：无<br>**后置条件**：返回酒店是否被用户收藏 |

### 5.6 信息视角

#### 5.6.1 描述数据持久化对象(PO)

酒店预订系统（HBS）的PO类就是对应的相关实体类，其定义如下，getter/setter方法已省略

* Coupon类属性：优惠券id，优惠券描述，优惠券发行人id，优惠券类型，优惠券名称，优惠券使用门槛，折扣，优惠券优惠金额，生效时间，失效时间，优惠券状态，

```java
public class Coupon{
    private int id;
    private String description;
    private Integer hotelId;
    private Integer couponType;
    private String couponName;
    private double targetMoney;
    private double discount;
    private double discountMoney;
    private LocalDateTime startTime;
    private LocalDateTime endTime;
    private Integer status;
}
```

* Hotel类属性：酒店id，酒店名称，酒店地址，酒店商圈，酒店星级，酒店评级，酒店描述，酒店联系电话，酒店管理员id

```java
public class Hotel{
    private Integer id;
    private String hotelName;
    private String address;
    private BizRegion bizRegion;
    private HotelStar hotelStar;
    private Double rate;
    private String description;
    private String phoneNum;
    private Integer managerId;
}
```

* HotelRoom类属性：房间id，房间类型，酒店id，房间每晚价格，当前剩余可预定房间数，某类型房间总数

```java
public class HotelRoom{
    private Integer id;
    private RoomType roomType;
    private Integer hotelId;
    private double price;
    private int curNum;
    private int total;
}
```

* Order类属性：订单id，预定客户id，酒店id，酒店名称，入住时间，退房时间，房间类型，房间号，入住人数，是否有儿童，预定日期，订单价格，预定人姓名，预定人联系方式，订单状态

```java
public class Order{
    private Integer id;
    private Integer userId;
    private Integer hotelId;
    private String hotelName;
    private String checkInDate;
    private String checkOutDate;
    private String roomType;
    private Integer roomNum;
    private Integer peopleNum;
    private boolean haveChild;
    private String createDate;
    private Double price;
    private String clientName;
    private String phoneNumber;
    private String orderState;
}
```

* User类属性：用户id，电子邮箱地址，密码，用户名，联系方式，信用值，用户类型，会员类型

```java
public class User{
    private Integer id;
    private String email;
    private String password;
    private String userName;
    private String phoneNumber;
    private double credit;
  	private VIPType vipType;
  	private String birthday;
  	private String companyName;
    private UserType userType;
}
```

* Vip类属性：用户id，会员类型，注册时间，公司名称，生日

```java
public class Vip{
  private Integer userId;
  private Integer vipType;
  private String registerDate;
  private String companyName;
  private String birthday;
}
```



#### 5.6.2 数据库表

数据库中包含coupon表，hotel表，orderList表，room表，user表，favorList表以及vip表